library(openxlsx)
library(readxl)
library(dplyr)
library(tidyr)

dataSource <- "avalia_23-09.xlsx" 
dataBase <- read_excel(dataSource)

curso_input <- "Ciências Naturais - Licenciatura"
campus_input <- "Breves"

filtered <- filter(dataBase, CURSO==curso_input, CAMPUS==campus_input)

colunas <- filtered %>% select(2,3, (37:43))

cols_disc <- filtered %>% select(2,3,(37:63))

medias <- cols_disc %>%
  group_by(DISCIPLINA, DOCENTE) %>%
  summarise(
    autoavdisc = mean(rowMeans(across(starts_with('P11')), na.rm = TRUE)),
    acaodocente = mean(rowMeans(across(starts_with('P2')), na.rm = TRUE)),
    atitudeprofissional = mean(rowMeans(across(starts_with('P21')), na.rm = TRUE)),
    gestaodidatica = mean(rowMeans(across(starts_with('P22')), na.rm = TRUE)),
    processoav = mean(rowMeans(across(starts_with('P23')), na.rm = TRUE)),
    instalacoesfisicas = mean(rowMeans(across(starts_with('P3')), na.rm = TRUE)),
  )

#criando tabela
minha_tabela <- data.frame(
  Disciplina = c(medias$DISCIPLINA),
  Docente = c(medias$DOCENTE),
  `Autoavaliação Discente` = c(round((medias$autoavdisc),2)),
  `Ação Docente` = c(round((medias$acaodocente),2)),
  `Atitude Profissional` = c(round((medias$atitudeprofissional),2)),
  `Gestão Didática` = c(round((medias$gestaodidatica),2)),
  `Processo Avaliativo` = c(round((medias$processoav),2)),
  `Instalações Físicas` = c(round((medias$instalacoesfisicas),2)),
  check.names=FALSE
)

#salvando tabela
write.xlsx(minha_tabela, file = "medias_avalia.xlsx")
