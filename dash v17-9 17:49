---
title: "AVALIA 2023.4"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(readxl)
library(tidyverse)
library(ggplot2)
library(shiny)
library(rmarkdown)
library(reshape2)
library(DT)


caminho <- "C:/Users/DIAVI/Documents/dashboard/data_test.xlsx"

dataSource <- "C:/Users/DIAVI/Documents/dashboard/avalia.xlsx" 
dataBase <- read_excel(dataSource) 

#base docente 
sourceDocente <- "C:/Users/DIAVI/Documents/dashboard/avalia_docente.xlsx"
baseDocente <- read_excel(sourceDocente)

##FUNÇÕES

#calculo percentural colunas
calculoPercent <- function(alternativas, vetorContagem){
    somaContagem <- sapply(alternativas, function(valor) {
      sum(sapply(vetorContagem, function(tabela){
        if (as.character(valor) %in% names(tabela)){
          return(tabela[as.character(valor)])
        }
        else {
          return(0)
        }
      }), na.rm = TRUE)
    })
    
    percentuais <- (somaContagem / sum(somaContagem)) * 100
    
    return(percentuais)
}

#grafico contagem
graficoContagem <- function(df, dimensao, conceito, valores, titulo){
  graficoC <<- ggplot(df, aes(x=dimensao, y=valores, fill=conceito))+
    geom_bar(stat="identity", position = position_dodge(width=0.95))+ 
    scale_fill_manual(values = c ("#1D556F", "#288FB4", "#F0B775", "#FA360A")) +
    geom_text(aes(label = round(valores,2)), vjust = -0.8, position = position_dodge(width = 0.9), size = 4, family = "sans", colour = "#494953") + 
    theme_minimal() +
    labs(x = NULL, y ="Percentual", title=titulo) + 
    scale_y_continuous(limits = c(0,100)) + 
    theme(panel.grid.major.x = element_blank()) +
    theme(legend.position = "right", 
          legend.title = element_blank(), 
          legend.text = element_text(size=10),
          axis.text.x = element_text(size=10.8),
          axis.text.y = element_text(size=9.6),
          axis.title.y = element_text(size=11.3),
          plot.title = element_text(size=11, 
                                    hjust = 0.5,
                                    margin = margin(0,0,2,0)))
  return(graficoC)
}

#grafico media
graficoMedia <- function(df, medias, dimensoes, titulo) {
  graficoM <<- ggplot(df, aes(x= dimensoes, y=medias, width=0.6)) +
    geom_bar(stat = "identity", fill = "#288FB4") +
    geom_text(aes(label = round(medias, 2)), vjust = -0.5, size=4.3) +
    labs(x=NULL, y=NULL, title=titulo) +
  #  scale_y_continuous( limits = c(1,4), breaks = seq(1, 4, 0.5) )
    scale_y_continuous(limits = c(0, 4)) +
    theme_minimal() +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(size=12.3),
          axis.text.y = element_text(size=11),
          plot.title = element_text(size=12, hjust = 0.5))
  
  return(graficoM)
}

#filtro dos dados
filtered_data <- reactive({
  baseDisc <- dataBase
  baseDoc <- baseDocente
  
  if (input$campus != "all") {
    baseDisc <- baseDisc %>% filter(CAMPUS == input$campus)
    baseDoc <- baseDoc %>% filter(CAMPUS == input$campus)
    
    if (input$curso != "all") {
      baseDisc <- baseDisc %>% filter(CURSO == input$curso)
      baseDoc <- baseDoc %>% filter(CURSO == input$curso)  # Corrigido aqui!
    }
  }
  
  list(disc = baseDisc, doc = baseDoc)
})

valoresUnicos <- function(df, intervalo){
  df <- df %>%
    select(ID, {{intervalo}})
  
  # Remove duplicatas considerando a coluna ID e as colunas de médias
  dfUnico <- df %>%
    distinct(ID, across(everything()), .keep_all = TRUE)
  
  return(dfUnico)
}

```

Sidebar {.sidebar}
=====================================
```{r}
#Filtros
selectInput(
  inputId="campus",
  choices = c("Todos" = "all", sort(unique(dataBase$CAMPUS))),
  label="Campus")

selectInput(
  inputId = "curso",
  label = "Curso",
  choices = c("Todos" = "all", sort(unique(dataBase$CURSO)))
)

#filtros dinamicos OBS ENXUTAR O CODIGO
observeEvent(input$campus, {
  if (input$campus == "all") {
    updateSelectInput(
      inputId = "curso",
      choices = c("Todos" = "all", sort(unique(dataBase$CURSO)))
    )
  } else {
    cursosFiltrados <- unique(c(
      dataBase %>%
        filter(CAMPUS == input$campus) %>%
        pull(CURSO),
      baseDocente %>%
        filter(CAMPUS == input$campus) %>%
        pull(CURSO)
    ))
    
    updateSelectInput(
      inputId = "curso",
      choices = c("Todos" = "all", sort(cursosFiltrados))
    )
  }
})

```

```{r}
#botao baixar relatorio

actionButton("openDocument", "Abrir Relatório")
downloadButton("downloadData", "Baixar Relatório")

output$downloadData <- downloadHandler(
  filename = function() {
    paste("relatorio_", input$campus, ".pdf", sep = "")
  },
  content = function(file) {
    data_filtered <- filtered_data() 
    data_filtered <- data_filtered$disc
    rmarkdown::render("relatorio.Rmd", 
                      output_file = file, 
                      params = list(data = data_filtered,
                                    campus = input$campus,
                                    curso = input$curso)) 
  }
)

observeEvent(input$openDocument, {
  output_file <- tempfile(fileext = ".pdf")
  data_filtered <- filtered_data()
  data_filtered <- data_filtered$disc
  
  rmarkdown::render("relatorio.Rmd", 
                    output_format = "pdf_document", 
                    output_file = output_file, 
                    params = list(data = data_filtered,
                                  campus = input$campus,
                                  curso = input$curso))
  
  # Abrindo o arquivo PDF gerado
  browseURL(output_file)
})


# output$downloadData <- downloadHandler(
#   filename = function() {paste("relatorio_", input$campus, ".pdf", sep = "")},
#   content = function(file) {rmarkdown::render("relatorio.Rmd", output_file = file, params = list(plot = output$chartA))}
# )
# 
# #output$openDocument <- knit(output = "relatorio.Rmd")
# observeEvent(input$openDocument, {output_file <- tempfile(fileext = ".pdf")
# rmarkdown::render("relatorio.Rmd", output_format = "pdf_document", output_file = output_file)
# browseURL(output_file)})

```


Dimensões Geral
=====================================  
    
Column {data-width=600}
-------------------------------------
    
### Proporções de respostas dadas por Dimensão
```{r}
renderPlot({
  data_filtered <- filtered_data()
  data_filtered <- data_filtered$disc
  
  contagensDisc <- lapply(data_filtered[, 40:46], table)
  contagensDoc <- lapply(data_filtered[, 47:62], table)
  contagensInfra <- lapply(data_filtered[, 63:66], table)
  
  alternativas <- c(1, 2, 3, 4)
  
  percentDisc <- calculoPercent(alternativas, contagensDisc)
  percentDoc <- calculoPercent(alternativas, contagensDoc)
  percentInfra <- calculoPercent(alternativas, contagensInfra)
  
  df <- data.frame(
  dimensao = rep(c("Auto Avaliação Discente", "Ação Docente", "Instalações Físicas"), each = length(percentDisc)),
  conceito = rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = 3),
  valores = c(percentDisc, percentDoc, percentInfra)
)
  
  df$conceito <- factor(df$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente"))
  
  df <- df[order(df$dimensao, df$conceito), ]
  
  contagemDG <<-  graficoContagem(df, df$dimensao, df$conceito, df$valores, "Figura 3 - Proporções de respostas dadas por Dimensão (Discente)")
  print(contagemDG)
})
```
   
Column {data-width=400}
-------------------------------------

### Médias por Dimensão
```{r}
renderPlot({
  data <- filtered_data()
  data <-data$disc
  
  mediasAvDiscente <- mean(unlist(cols22 <- data %>%
                           select(P111:P117)), na.rm=TRUE)
  mediasAcaoDocente <- mean(unlist(cols22 <- data %>%
                           select(P211:P234)), na.rm=TRUE)
  mediasInfra <- mean(unlist(cols22 <- data %>%
                           select(P311:P314)), na.rm=TRUE)
  
  df <- data.frame(media = c(mediasAcaoDocente, mediasAvDiscente, mediasInfra),
                   dimensoes = c("Ação Docente", "Autoavaliação Discente", "Instalações Físicas"))
  
  mediaGeral <<- graficoMedia(df, df$media, df$dimensoes, "Figura 1 - Médias por dimensão (Discente)")
  print(mediaGeral)
})
```   
 
### boxplot das medias
```{r}

renderPlot({
  
  data_filtered <- filtered_data()
  data_filtered <- data_filtered$disc
  
  unicosDisc <- valoresUnicos(data_filtered, mediap111:mediap117)
  unicosDoc <- valoresUnicos(data_filtered, mediap211:mediap234)
  unicosInfra <- valoresUnicos(data_filtered, mediap311:mediap314)
  
  long_disc <- unicosDisc %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Autoavaliação Discente")
  
  long_doc <- unicosDoc %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Ação Docente")
  
  long_infra <- unicosInfra %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Instalações Físicas")
  
  df_dimensoes <- bind_rows(long_disc, long_doc, long_infra)
  
  boxplotGeral <<- ggplot(df_dimensoes, aes(x = dimensao, y = media)) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 5 - Distribuição das Médias das Avaliações das Turmas/Docente por Dimensão")

    print(boxplotGeral)
  
})


```



Autoavaliação Discente {data-orientation=rows}
=====================================     
   
Row {data-height=500}
-------------------------------------
### Proporções de respostas dadas aos itens relacionados à Autoavaliação Discente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  contagemD <- lapply(data[, 40:46], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("1.1.1", "1.1.2", "1.1.3", "1.1.4", "1.1.5", "1.1.6", "1.1.7"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDisc <- dfDisc[order(dfDisc$questoes, dfDisc$conceito), ]
  
  contagemDisc <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 28 – Proporções de respostas dadas aos itens relacionados à Autoavaliação Discente")
  print(contagemDisc)
  
})
```

Row {data-height=500}
-------------------------------------
   

### Médias dos itens relacionados à Autoavaliação Discente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  mediasDiscente <- colMeans(data[, 40:46])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("1.1.1", "1.1.2", "1.1.3", "1.1.4", "1.1.5", "1.1.6", "1.1.7"))
  mediasDisc <<- graficoMedia(df, df$medias, df$questoes, "Figura 26 – Médias dos itens relacionados à Autoavaliação Discente")
  print(mediasDisc)
})
```   
  

### Boxplot Discente
```{r, echo=FALSE, warning=FALSE, message=FALSE}
suppressWarnings({
  renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc

    # Aplicar a função valoresUnicos nos dados filtrados
    data_filtered <- valoresUnicos(data_filtered, mediap111:mediap117)
    
    data_long <- data_filtered %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "variavel",
                   values_to = "media")
                   
    boxplotDisc <<-
      ggplot(data_long, aes(x = variavel, y = media)) +
      scale_x_discrete(labels = c("mediap111" = "1.1.1",
                                "mediap112" = "1.1.2",
                                "mediap113" = "1.1.3",
                                "mediap114" = "1.1.4",
                                "mediap115" = "1.1.5",
                                "mediap116" = "1.1.6",
                                "mediap117" = "1.1.7")) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 30 – Distribuição das Médias das Avaliações das Turmas/Docentes por Item relacionado à Autoavaliação Discente")

    print(boxplotDisc)
  })
})
```


Avaliação Ação Docente {data-orientation=rows}
=====================================     
   
Row {data-height=600}
-------------------------------------

### Proporções de respostas por Subdimensão da Avaliação da Ação Docente
```{r}
renderPlot({
  
  data <- filtered_data()
  data <- data$disc
  
  contagem21 <- lapply(data[, 47:50], table)
  contagem22 <- lapply(data[, 51:58], table)
  contagem23 <- lapply(data[, 59:62], table)
  
  alternativas <- c(1, 2, 3, 4)
  
  dfDoc <- data.frame(
    subdimensoes = rep(c("Atitude Profissional", "Gestão Didática", "Processo Avaliativo"), each = 4),
    conceito = rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = 3),
    valores = c(
      calculoPercent(alternativas, contagem21),
      calculoPercent(alternativas, contagem22),
      calculoPercent(alternativas, contagem23)
    )
  )
  
  # Reordenar o fator conceito
  dfDoc$conceito <- factor(dfDoc$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente"))
  
  # Ordenar o dataframe para que os valores sejam alinhados corretamente com os conceitos
  dfDoc <- dfDoc[order(dfDoc$subdimensoes, dfDoc$conceito), ]
  
  # Criar o gráfico com os valores corretamente alinhados
  contagemDoc <<- graficoContagem(dfDoc, dfDoc$subdimensoes, dfDoc$conceito, dfDoc$valores, "Figura 8 – Proporções de respostas dadas por Subdimensão da Avaliação da Ação Docente")
  print(contagemDoc)
})
```

Row {data-height=400}
-------------------------------------
   
### Médias por Subdimensão da Avaliação da Ação Docente
```{r}
renderPlot({
  data <- filtered_data()      
  data <- data$disc
  
  medias21 <- mean(unlist(cols22 <- data %>%
                           select(P211:P214)), na.rm=TRUE)
  medias22 <- mean(unlist(cols22 <- data %>%
                           select(P221:P228)), na.rm=TRUE)
  medias23 <- mean(unlist(cols22 <- data %>%
                           select(P231:P234)), na.rm=TRUE)

  df <- data.frame(medias = c(medias21, medias22, medias23),
                   subdimensoes = c("Atitude Profissional", "Gestão Didática", "Processo Avaliativo"))
  mediasDoc <<- graficoMedia(df, df$medias, df$subdimensoes, "Figura 6 - Médias por Subdimensão da Avaliação da Ação Docente")
  print(mediasDoc)
})
```   
### Boxplot Médias Avaliação Docente
```{r}
suppressWarnings({ 
  renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc
    
    unicos21 <- valoresUnicos(data_filtered, mediap211:mediap214)
    unicos22 <- valoresUnicos(data_filtered, mediap221:mediap228)
    unicos23 <- valoresUnicos(data_filtered, mediap231:mediap234)
    
    long_21 <- unicos21 %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Atitude Profissional")
    
    long_22 <- unicos22 %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Gestão Didática")
    
    long_23 <- unicos23 %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "dimensao",
                   values_to = "media") %>%
      mutate(dimensao = "Processo Avaliativo")
    
    df_mesclado <- bind_rows(long_21, long_22, long_23)
    
    boxplotDoc <<- ggplot(df_mesclado, aes(x = dimensao, y = media)) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 10 – Distribuição das Médias das Avaliações das Turmas/Docentes por Subdimensão da Ação
Docente
")

    print(boxplotDoc)
  })
})
```


ATIVIDADES
================================================================
Row {data-height=500}
-------------------------------------

### Percentual Atividades Base Discente
```{r}
#Percentual de Participação em Atividades Acadêmicas por Atividade
renderPlot({
  
  data_filtered <- filtered_data()
  data_filtered <- data_filtered$disc

  intervalo_colunas <- data_filtered %>%
    select(A:R)
  
  colunas_nomes <- colnames(intervalo_colunas)
  
  intervalo_colunas[intervalo_colunas == ""] <- 0
  
  contagem_colunas <- colSums(intervalo_colunas == 1, na.rm = TRUE)
  
  percentuais <- (contagem_colunas/nrow(data_filtered))*100
  
  df <- data.frame(percentual = percentuais,
                   alternativas = colunas_nomes)
  
  atividadeDisc <<- ggplot(df, aes(x= alternativas, y=percentual, width=0.9)) +
    geom_bar(stat = "identity", fill = "#288FB4") +
    geom_text(aes(label = round(percentuais, 2)), vjust = -0.5, size=4.3) +
    scale_y_continuous(limits = c(0, 100)) +
    labs(x=NULL, y="Percentual", title="Figura 36 - Percentual de Participação em Atividades Acadêmicas por Atividade (Discente)") +
    theme_minimal() +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(size=12.3),
          axis.text.y = element_text(size=11),
          plot.title = element_text(size=14, hjust = 0.5))
  print(atividadeDisc)
})
```

### Percentual Atividades Base Docente
```{r}
#Percentual de Participação em Atividades Acadêmicas por Atividade
renderPlot({
  
  data_filtered <- filtered_data()
  data_filtered <- data_filtered$doc

  intervalo_colunas <- data_filtered %>%
    select(A:P)
  
  colunas_nomes <- colnames(intervalo_colunas)
  
  intervalo_colunas[intervalo_colunas == ""] <- 0
  
  contagem_colunas <- colSums(intervalo_colunas == 1, na.rm = TRUE)
  
  percentuais <- (contagem_colunas/nrow(data_filtered))*100
  
  df <- data.frame(percentual = percentuais,
                   alternativas = colunas_nomes)
  
  atividadeDoc <<- ggplot(df, aes(x= alternativas, y=percentual, width=0.9)) +
    geom_bar(stat = "identity", fill = "#288FB4") +
    geom_text(aes(label = round(percentuais, 2)), vjust = -0.5, size=4.3) +
    scale_y_continuous(limits = c(0, 100)) +
    labs(x=NULL, y="Percentual", title="Figura 37 – Percentual de Participação em Atividades Acadêmicas por Atividade (Docente)") +
    theme_minimal() +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(size=12.3),
          axis.text.y = element_text(size=11))
  print(atividadeDoc)
})
```







base docente
================================================================
Column {data-width=600}
-------------------------------------
### Médias dos itens relacionados à Avaliação da Turma 1.1
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  mediasAvTurma <- colMeans(data[, 15:21])
  
  df <- data.frame(medias = mediasAvTurma,
                   questoes = c("1.1.1", "1.1.2", "1.1.3", "1.1.4", "1.1.5", "1.1.6", "1.1.7"))
  
  mediasAvTurma <<- graficoMedia(df, df$medias, df$questoes, "Figura 27 – Médias dos itens relacionados à Avaliação da Turma")
  print(mediasAvTurma)
})
``` 


### Médias dos itens relacionados à Ação Docente 2.1
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc

  cols21 <- data %>% 
    select(P211:P214)
  media21 <- mean(unlist(cols21), na.rm=TRUE)
  
  media22 <- mean(unlist(cols22 <- data %>%
                           select(P221:P228)), na.rm=TRUE)
  media23 <- mean(unlist(cols22 <- data %>%
                           select(P231:P234)), na.rm=TRUE)
  
  df <- data.frame(medias = c(media21, media22, media23),
                   dimensoes = c("Atitude Profissional", "Gestão Didática", "Processo Avaliativo"))
  
   mediasAutoavDoc <<- graficoMedia(df, df$medias, df$dimensoes, "Figura 7 - Médias por Subdimensão da Autoavaliação da Ação Docente")
   print(mediasAutoavDoc)
})
``` 

### Médias por dimensao (DOCENTE)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  media11 <- mean(unlist(cols22 <- data %>%
                           select(P111:P117)), na.rm=TRUE)
  media21 <- mean(unlist(cols22 <- data %>%
                           select(P211:P234)), na.rm=TRUE)
  media31 <- mean(unlist(cols22 <- data %>%
                           select(P311:P314)), na.rm=TRUE)
  df <- data.frame(medias = c(media11, media21, media31),
                   dimensoes = c("Avaliação da Turma", "Autoavaliação da Ação Docente", "Instalações Físicas"))
  mediaGeralDoc <<- graficoMedia(df, df$medias, df$dimensoes, "Figura 2 - Médias por dimensão (Docente)")
})
```


Column {data-width=400}
-------------------------------------
### Contagem 1.1 base docente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagem11 <- lapply(data [, 14:20], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagem11, function(tabela) {
    percentuais <- (tabela / sum(tabela)) * 100
    percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })
  
  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("1.1.1", "1.1.2", "1.1.3", "1.1.4", "1.1.5", "1.1.6", "1.1.7"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  contagem11Doc <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 29 – Proporções de respostas dadas aos itens relacionados à Avaliação da Turma")
  print(contagem11Doc)
})
```
### Contagem 2.1 base docente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagem21 <- lapply(data [, 21:24], table)
  contagem22 <- lapply(data [, 25:32], table)
  contagem23 <- lapply(data [, 33:36], table)
  
  alternativas <- c(1,2,3,4)
  
  dfDoc <- data.frame(subdimensoes = rep(c("Atitude Profissional", "Gestão Didática", "Processo Avaliativo"), each=4),
                       conceito = rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = 3),
                       valores = c( calculoPercent(alternativas,contagem21), calculoPercent(alternativas,contagem22), calculoPercent(alternativas,contagem23)))
  
  dfDoc$conceito <- factor(dfDoc$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente"))
  
  print("VALORES ACAO DOCENTE BASE DOCENTE")
  print(dfDoc$valores)
  
  contagem21Doc <<- graficoContagem(dfDoc, dfDoc$subdimensoes, dfDoc$conceito, dfDoc$valores, "Figura 9 – Proporções de respostas dadas por Subdimensão da Autoavaliação da Ação Docente
")
  print(contagem21Doc)
})
```

### Contagem Geral base docente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagemDisc <- lapply(data [, 14:20], table)
  contagemDoc <- lapply(data [, 21:36], table)
  contagemInfra <- lapply(data [, 37:40], table)
  
  alternativas <- c(1,2,3,4)
  
  percentDisc <- calculoPercent(alternativas, contagemDisc)
  percentDoc <- calculoPercent(alternativas, contagemDoc)
  percentInfra <- calculoPercent(alternativas, contagemInfra)
  
  df <- data.frame(
  subdimensoes = rep(c("Avaliação da Turma", "Autoavaliação da Ação Docente", "Instalações Físicas"), each = 4),
  conceito = rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = 3),
  valores = c(percentDisc, percentDoc, percentInfra))
  
  df$conceito <- factor(df$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente"))
  
  contagemGeralDoc <<- graficoContagem(df, df$subdimensoes, df$conceito, df$valores, "Figura 4 - Proporções de respostas dadas por Dimensão (Docente)")
})
```


Gráficos Atitude Profissional 2.1
================================================================
Column {data-width=600}
-------------------------------------
## Médias dos itens relacionados à Atitude Profissional (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  mediasDiscente <- colMeans(data[, 47:50])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("2.1.1", "2.1.2", "2.1.3", "2.1.4"))
  mediasAtProfissionalDi <<- graficoMedia(df, df$medias, df$questoes, "Figura 11 – Médias dos itens relacionados à Atitude Profissional (Discente)")
  print(mediasAtProfissionalDi)
})
``` 

## Médias dos itens relacionados à Atitude Profissional (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  mediasDoc <- colMeans(data[, 20:23])
  
  df <- data.frame(medias = mediasDoc,
                   questoes = c("2.1.1", "2.1.2", "2.1.3", "2.1.4"))
  mediasAtProfissionalDo <<- graficoMedia(df, df$medias, df$questoes,"Figura 12 – Médias dos itens relacionados à Atitude Profissional (Docente)")
  print(mediasAtProfissionalDo)
})
``` 

## Contagem 2.1 Discente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  contagemD <- lapply(data[, 47:50], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("2.1.1", "2.1.2", "2.1.3", "2.1.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDisc <- dfDisc[order(dfDisc$questoes, dfDisc$conceito), ]
  
  contagemAtProfissionalDi <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 13 – Proporções de respostas dadas aos itens relacionados à Atitude Profissional (Discente)")
  print(contagemAtProfissionalDi)
  
})
```

## Contagem 2.1 Docente
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagemD <- lapply(data[, 20:23], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDoc <- data.frame(
  questoes = rep(c("2.1.1", "2.1.2", "2.1.3", "2.1.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDoc <- dfDoc[order(dfDoc$questoes, dfDoc$conceito), ]
  
  contagemAtProfissionalDoc <<- graficoContagem(dfDoc, dfDoc$questoes, dfDoc$conceito, dfDoc$valores, "Figura 14 – Proporções de respostas dadas aos itens relacionados à Atitude Profissional (Docente)")
  print(contagemAtProfissionalDoc)
  
})
```

## Boxplot 2.1 Discente
```{r, echo=FALSE, warning=FALSE, message=FALSE}
renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc

    # Aplicar a função valoresUnicos nos dados filtrados
    data_filtered <- valoresUnicos(data_filtered, mediap211:mediap214)
    
    data_long <- data_filtered %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "variavel",
                   values_to = "media")
                   
    boxplotAtitude <<-
      ggplot(data_long, aes(x = variavel, y = media)) +
      scale_x_discrete(labels = c("mediap211" = "2.1.1",
                                "mediap212" = "2.1.2",
                                "mediap213" = "2.1.3",
                                "mediap214" = "2.1.4")) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 15 – Distribuição das Médias das Avaliações das Turmas/Docentes por Item relacionado à Atitude Profissional")

    print(boxplotAtitude)
})
```


Gráficos Gestao Didatica 2.2
================================================================
Column {data-width=600}
-------------------------------------
## Médias dos itens relacionados à Gestão Didática (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  mediasDiscente <- colMeans(data[, 51:58])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("2.2.1", "2.2.2", "2.2.3", "2.2.4","2.2.5", "2.2.6", "2.2.7", "2.2.8"))
  mediasGestaoDi <<- graficoMedia(df, df$medias, df$questoes,"Figura 16 – Médias dos itens relacionados à Gestão Didática (Discente)")
  print(mediasGestaoDi)
})
``` 

## Médias dos itens relacionados à Gestão Didática (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  mediasDiscente <- colMeans(data[, 24:31])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("2.2.1", "2.2.2", "2.2.3", "2.2.4","2.2.5", "2.2.6", "2.2.7", "2.2.8"))
  mediasGestaoDoc <<- graficoMedia(df, df$medias, df$questoes,"Figura 17 – Médias dos itens relacionados à Gestão Didática (Docente)")
  print(mediasGestaoDoc)
})
``` 



## Contagem Gestão Didática (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  contagemD <- lapply(data[, 51:58], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("2.2.1", "2.2.2", "2.2.3", "2.2.4","2.2.5","2.2.6","2.2.7","2.2.8"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDisc <- dfDisc[order(dfDisc$questoes, dfDisc$conceito), ]
  
  contagemGestaoDisc <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 18 – Proporções de respostas dadas aos itens relacionados à Gestão Didática (Discente)")
  print(contagemGestaoDisc)
})
```

## Contagem Gestão Didática (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagemD <- lapply(data[, 24:31], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDoc <- data.frame(
  questoes = rep(c("2.2.1", "2.2.2", "2.2.3", "2.2.4","2.2.5","2.2.6","2.2.7","2.2.8"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDoc <- dfDoc[order(dfDoc$questoes, dfDoc$conceito), ]
  
  contagemGestaoDoc <<- graficoContagem(dfDoc, dfDoc$questoes, dfDoc$conceito, dfDoc$valores, "Figura 19 – Proporções de respostas dadas aos itens relacionados à Gestão Didática (Docente)")
  print(contagemGestaoDoc)
})
```

## Boxplot Gestao Didatica
```{r, echo=FALSE, warning=FALSE, message=FALSE}
renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc

    # Aplicar a função valoresUnicos nos dados filtrados
    data_filtered <- valoresUnicos(data_filtered, mediap221:mediap228)
    
    data_long <- data_filtered %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "variavel",
                   values_to = "media")
                   
    boxplotGestao <<-
      ggplot(data_long, aes(x = variavel, y = media)) +
      scale_x_discrete(labels = c("mediap221" = "2.2.1",
                                "mediap222" = "2.2.2",
                                "mediap223" = "2.2.3",
                                "mediap224" = "2.2.4",
                                "mediap225" = "2.2.5",
                                "mediap226" = "2.2.6",
                                "mediap227" = "2.2.7",
                                "mediap228" = "2.2.8")) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 20 – Distribuição das Médias das Avaliações das Turmas/Docentes por Item relacionado à Gestão Didática")

    print(boxplotGestao)
})
```


Gráficos Processo Avaliativo 2.3
================================================================
Column {data-width=600}
-------------------------------------
## Médias dos itens relacionados à Processo Avaliativo (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  mediasDiscente <- colMeans(data[, 59:62])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("2.3.1", "2.3.2", "2.3.3", "2.3.4"))
  mediasProcessoDi <<- graficoMedia(df, df$medias, df$questoes,"Figura 21 – Médias dos itens relacionados ao Processo Avaliativo (Discente)")
  print(mediasProcessoDi)
})
``` 

## Médias dos itens relacionados à Processo Avaliativo (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  mediasDoc <- colMeans(data[, 32:35])
  
  df <- data.frame(medias = mediasDoc,
                   questoes = c("2.3.1", "2.3.2", "2.3.3", "2.3.4"))
  mediasProcessoDoc <<- graficoMedia(df, df$medias, df$questoes,"Figura 22 – Médias dos itens relacionados ao Processo Avaliativo (Docente)")
  print(mediasProcessoDoc)
})
``` 

## Contagem Processo Avaliativo (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  contagemD <- lapply(data[, 59:62], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("2.3.1", "2.3.2", "2.3.3", "2.3.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDisc <- dfDisc[order(dfDisc$questoes, dfDisc$conceito), ]
  
  contagemProcessoDisc <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 23 – Proporções de respostas dadas aos itens relacionados ao Processo Avaliativo (Discente)")
  print(contagemProcessoDisc)
})
```

## Contagem Processo Avaliativo (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagemD <- lapply(data[, 32:35], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDoc <- data.frame(
  questoes = rep(c("2.3.1", "2.3.2", "2.3.3", "2.3.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDoc <- dfDoc[order(dfDoc$questoes, dfDoc$conceito), ]
  
  contagemProcessoDoc <<- graficoContagem(dfDoc, dfDoc$questoes, dfDoc$conceito, dfDoc$valores, "Figura 24 – Proporções de respostas dadas aos itens relacionados ao Processo Avaliativo (Docente)")
  print(contagemProcessoDoc)
})
```
## Boxplot Processo Avaliativo
```{r, echo=FALSE, warning=FALSE, message=FALSE}
renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc

    # Aplicar a função valoresUnicos nos dados filtrados
    data_filtered <- valoresUnicos(data_filtered, mediap231:mediap234)
    
    data_long <- data_filtered %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "variavel",
                   values_to = "media")
                   
    boxplotProcesso <<-
      ggplot(data_long, aes(x = variavel, y = media)) +
      scale_x_discrete(labels = c("mediap231" = "2.3.1",
                                "mediap232" = "2.3.2",
                                "mediap233" = "2.3.3",
                                "mediap234" = "2.3.4")) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 25 – Distribuição das Médias das Avaliações das Turmas/Docentes por Item relacionado ao Processo Avaliativo")

    print(boxplotProcesso)
})
```





Gráficos Instalação Física
================================================================
Column {data-width=600}
----------------------------------------------------------------------
## Médias dos itens relacionados às Instalações Físicas (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  mediasDiscente <- colMeans(data[, 63:66])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("3.1.1", "3.1.2", "3.1.3", "3.1.4"))
  mediasInfraDisc <<- graficoMedia(df, df$medias, df$questoes,"Figura 31 – Médias dos itens relacionados às Instalações físicas (Discente)")
  print(mediasInfraDisc)
})
``` 

## Médias dos itens relacionados às Instalações Físicas (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  mediasDiscente <- colMeans(data[, 36:39])
  
  df <- data.frame(medias = mediasDiscente,
                   questoes = c("3.1.1", "3.1.2", "3.1.3", "3.1.4"))
  mediasInfraDoc <<- graficoMedia(df, df$medias, df$questoes,"Figura 32 – Médias dos itens relacionados às Instalações físicas (Docente)")
  print(mediasInfraDoc)
})
```

## Contagem Instalações Físicas (Discente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$disc
  
  contagemD <- lapply(data[, 63:66], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDisc <- data.frame(
  questoes = rep(c("3.1.1", "3.1.2", "3.1.3", "3.1.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDisc <- dfDisc[order(dfDisc$questoes, dfDisc$conceito), ]
  
  contagemInfraDisc <<- graficoContagem(dfDisc, dfDisc$questoes, dfDisc$conceito, dfDisc$valores, "Figura 33 – Proporções de respostas dadas aos itens relacionados às Instalações físicas (Discente)")
  print(contagemInfraDisc)
})
```

## Contagem Instalações Físicas (Docente)
```{r}
renderPlot({
  data <- filtered_data()
  data <- data$doc
  
  contagemD <- lapply(data[, 36:39], table)
  
  alternativas <- c(1,2,3,4)
  
  percentuaisD <- lapply(contagemD, function(tabela) {
  # Dividir cada valor na tabela pelo total de contagens da questão
  percentuais <- (tabela / sum(tabela)) * 100
  # Garantir que todas as alternativas estejam presentes, mesmo se não aparecerem na tabela
  percentuais_completos <- sapply(alternativas, function(alt) {
    if (as.character(alt) %in% names(percentuais)) {
      return(percentuais[as.character(alt)])
    } else {
      return(0)
    }
  })
  return(percentuais_completos)
  })

  df <- data.frame(percentuaisD)
  
  dfLong <- reshape2::melt(df, varnames = "questoes", value.name = "valores")
  
  dfLong$conceito <- rep(c("Insuficiente", "Regular", "Bom", "Excelente"), times = ncol(df))
  
  dfDoc <- data.frame(
  questoes = rep(c("3.1.1", "3.1.2", "3.1.3", "3.1.4"), each = 4),
  conceito = factor(dfLong$conceito, levels = c("Excelente", "Bom", "Regular", "Insuficiente")),
  valores = dfLong$valores)
  
  dfDoc <- dfDoc[order(dfDoc$questoes, dfDoc$conceito), ]
  
  contagemInfraDoc <<- graficoContagem(dfDoc, dfDoc$questoes, dfDoc$conceito, dfDoc$valores, "Figura 34 – Proporções de respostas dadas aos itens relacionados às Instalações físicas (Docente)")
  print(contagemInfraDoc)
})
```
## Boxplot Instalações Físicas
```{r, echo=FALSE, warning=FALSE, message=FALSE}
renderPlot({
    data_filtered <- filtered_data()
    data_filtered <- data_filtered$disc

    # Aplicar a função valoresUnicos nos dados filtrados
    data_filtered <- valoresUnicos(data_filtered, mediap311:mediap314)
    
    data_long <- data_filtered %>%
      pivot_longer(cols = starts_with("mediap"),
                   names_to = "variavel",
                   values_to = "media")
                   
    boxplotInfra <<-
      ggplot(data_long, aes(x = variavel, y = media)) +
      scale_x_discrete(labels = c("mediap311" = "3.1.1",
                                "mediap312" = "3.1.2",
                                "mediap313" = "3.1.3",
                                "mediap314" = "3.1.4")) +
      stat_boxplot(geom = "errorbar", width = 0.6) +
      geom_boxplot(outlier.color = "#B4B4B8", fill = "#288FB4") +
      theme_minimal() +
      scale_y_continuous(limits = c(1,4)) +
      theme(axis.text.x = element_text(size = 10.3),
            plot.title = element_text(size=10.5, 
                                    hjust = 0.5)) +
      labs(x = NULL, y = "Média", title="Figura 35 – Distribuição das Médias das Avaliações das Turmas/Docentes por Item relacionado às Instalações Físicas")

    print(boxplotInfra)
})
```

```{r}
renderPlot({
  data <- filtered_data()
  data_disc <- data$disc
  
  # Seleciona as colunas específicas
  col211 <- data_disc %>% select(mediap211)
  print(col211)
  summy = summary(col211$mediap211)
  print(summary(col211))
  
  stats <- as.numeric(summy[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
  print(stats)
})  
#   acaoDoc <- data_disc %>% select(mediap211:mediap234)
#   instFisica <- data_disc %>% select(mediap311:mediap314)
#   
#   # Transforma os dados em formato longo para possíveis visualizações
#   data_long <- autoAvDisc %>%
#     pivot_longer(cols = starts_with("mediap"), names_to = "autoav", values_to = "medias")
#   
#   print("PRINTANDO DATA LONG MEDIAP1.1")
#   print(data_long)
#   
#   # Exibe o resumo das médias
#   print(summary(data_long$medias))
#   
#   stats <- summary(data_long$medias)
#   
#   info <- as.numeric(stats[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
#   
#   print(info)
# 


# <!-- ```{r, echo = FALSE,  prompt=TRUE, comment="", results='asis', message=FALSE, warning=FALSE} -->
# 
# <!-- atProfi <- data_filtered %>% select(mediap211:mediap214) -->
# <!-- gestaoDidat <- data_filtered %>% select(mediap221:mediap228) -->
# <!-- instFisica <- data_filtered %>% select(mediap231:mediap234) -->
# 
# <!-- longAtProfi <- atProfi %>% -->
# <!--     pivot_longer(cols = starts_with("mediap"), names_to = "autoav", values_to = "medias") -->
# 
# <!-- longGestao <- gestaoDidat %>% -->
# <!--     pivot_longer(cols = starts_with("mediap"), names_to = "autoav", values_to = "medias") -->
# 
# <!-- longProcesso <- instFisica %>% -->
# <!--     pivot_longer(cols = starts_with("mediap"), names_to = "autoav", values_to = "medias") -->
# 
# <!-- stats211 <- summary(data_filtered$mediap211) -->
# <!-- statsDoc <- summary(longGestao$medias) -->
# <!-- statsInfra <- summary(longProcesso$medias) -->
# 
# <!-- infoAtitude <- as.numeric(statsDisc[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")]) -->
# <!-- infoGestao <- as.numeric(statsDoc[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")]) -->
# <!-- infoProcesso <- as.numeric(statsInfra[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")]) -->
# 
# <!-- tabela3 <- data.frame( -->
# <!--   Estatística = c("Min", "1º Q.", "Mediana", "Média", "3º Q.", "Max"), -->
# <!--   `2.1.1` = stats211,  -->
# <!--   `2.1.2` = infoGestao,  -->
# <!--   `2.1.3` = infoProcesso, -->
# <!--   `2.1.4` = infoProcesso -->
# <!-- ) -->
# 
# <!-- knitr::kable(tabela3, format = "latex", caption = "Tabela 3 – Estatísticas descritivas das Médias das Avaliações das Turmas/Docentes por Subdimensão da Ação Docente") -->
# <!-- ``` -->


# 
# ```{r}
# kable(stats, caption = "Resumo Estatístico", align = 'c')
# ```




# col211 <- data_filtered %>% select(mediap211)
# col212 <- data_filtered %>% select(mediap212)
# col213 <- data_filtered %>% select(mediap213)
# col214 <- data_filtered %>% select(mediap214)
# 
# summary211 = summary(col211$mediap211)
# summary212 = summary(col212$mediap212)
# summary213 = summary(col213$mediap213)
# summary214 = summary(col214$mediap214)
# 
# stats211 <- as.numeric(summary211[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
# stats212 <- as.numeric(summary212[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
# stats213 <- as.numeric(summary213[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
# stats214 <- as.numeric(summary214[c("Min.","1st Qu.", "Median", "Mean", "3rd Qu.", "Max.")])
# 
# tabela4 <- data.frame(
#   Estatística = c("Min", "1º Q.", "Mediana", "Média", "3º Q.", "Max"),
#   `2.1.1` = stats211,
#   `2.1.2` = stats212,  
#   `2.1.3` = stats213,
#   `2.1.4` = stats214,
# )
# 
# knitr::kable(tabela4, format = "latex", caption = "Tabela 4 – Estatísticas descritivas das Médias das Avaliações das Turmas/Docentes por Item relacionado à Atitude Profissional")



# <!-- \newpage -->
# <!-- ```{r, echo = FALSE, fig.align = 'center', fig.width = 7.5, fig.height = 4.2, fig.pos='H'} -->
# <!-- print(boxplotGeral) -->
# <!-- ``` -->


```
